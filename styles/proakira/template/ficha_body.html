<!-- INCLUDE overall_header.html -->
<link rel="stylesheet" href="/styles/proakira/theme/ficha.css?v=1.0.1" type="text/css">
<link rel="stylesheet" href="/styles/proakira/theme/cambiosficha.css?v=1.0.1" type="text/css">
	
	<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-12">
            <form method="POST" action="/ficha/store" onsubmit="return checkFicha();">
                <div class="card">
                    <div class="card-header">
                        <ul class="nav nav-tabs" id="myTab" role="tablist" style="">
                          <li class="nav-item">
                            <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home" aria-selected="true"><h5>Datos Personales</h5></a>
                          </li>
                          <li class="nav-item">
                            <a class="nav-link" id="contact-tab" data-toggle="tab" href="#contact" role="tab" aria-controls="contact" aria-selected="false"><h5>Ramas</h5></a>
                          </li>
                          <li class="nav-item">
                            <a class="nav-link" id="atributos-tab" data-toggle="tab" href="#atributos" role="tab" aria-controls="atributos" aria-selected="false"><h5>Atributos</h5></a>
                          </li>
                        </ul>
                    </div>
                    <div class="card-body">
                        <div class="tab-content" id="myTabContent">
                          <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
						  <h3>Datos Personales</h3><br>
                            <div class="form-group row">
                                <label for="name" class="col-3 col-form-label text-md-left">Nombre</label>

                                <div class="col-6">
                                    <input id="name" type="text" class="form-control" name="name" value="" required>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="edad" class="col-3 col-form-label text-md-left">Edad</label>

                                <div class="col-6">
                                    <input id="edad" type="number" class="form-control" name="edad" value="" required  min="10" max="20">
                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="descFis" class="col-3 col-form-label text-md-left">Descripci&oacute;n F&iacute;sica</label>
                                <div class="col-6">
                                    <textarea class="form-control" name="descFis" id="descFis" placeholder="Descripción física" required="required" onfocus="this.style.height='200px';" onblur="this.style.height='60px'"></textarea>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="descPsic" class="col-3 col-form-label text-md-left">Descripción Psicol&oacute;gica</label>
                                <div class="col-6">                                  
                                    <textarea class="form-control" name="descPsic" id="descPsic" placeholder="Descripción Psicológica" required="required" onfocus="this.style.height='200px';" onblur="this.style.height='60px'"></textarea>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="descHis" class="col-3 col-form-label text-md-left">Historia</label>
                                <div class="col-6">    
                                    <textarea class="form-control" name="descHis" id="descHis" placeholder="Historia" required="required" onfocus="this.style.height='300px';" onblur="this.style.height='60px'"></textarea>
                                </div>
                            </div>
                          </div>
                          <div class="tab-pane fade" id="contact" role="tabpanel" aria-labelledby="contact-tab">
							<h3>Ramas de Técnicas</h3><br>
                                <div class="form-group row">
                                    <label for="ramaPrincipal" class="col-2 col-form-label text-md-left">Rama Principal:</label>
                                    <div class="col-7">
                                        <select class="form-control" name="ramaPrincipal">
                                            <option value="Sin Clan">Sin Clan</option>
                                            <option value="Ninpo Namikaze">Ninpo Namikaze </option>
                                            <option value="Medicina">Medicina</option>
                                            <option value="Elemento Explosivo">Elemento Explosivo</option>
                                            <option value="Elemento Lava">Elemento Lava</option>
                                            <option value="Origami">Origami</option>
                                            <option value="Elemento Arena de Hierro">Elemento Arena de Hierro</option>
                                            <option value="Clan Nara">Clan Nara</option>
                                            <option value="Elemento Tormenta">Elemento Tormenta</option>
                                            <option value="Clan Hyūga">Clan Hyūga</option>
                                            <option value="Elemento Cristal">Elemento Cristal</option>
                                            <option value="Elemento Calor">Elemento Calor</option>
                                            <option value="Clan Senju">Clan Senju</option>
                                            <option value="Clan Uchiha">Clan Uchiha</option>
                                            <option value="Clan Jyugo">Clan Jyūgo</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label for="ramaSec1" class="col-2 col-form-label text-md-left">Segunda Rama:</label>
                                    <div class="col-7">
                                        <select id="ramaSec1" class="form-control" name="ramaSec1">
                                            <option value="Ninjutsu General">Ninjutsu General</option>
                                            <option value="Elemento Viento">Elemento Viento</option>
                                            <option value="Elemento Fuego">Elemento Fuego</option>
                                            <option value="Elemento Tierra">Elemento Tierra</option>
                                            <option value="Elemento Rayo">Elemento Rayo</option>
                                            <option value="Elemento Agua">Elemento Agua</option>
                                            <option value="Bukijutsu">Bukijutsu</option>
                                            <option value="Genjutsu">Genjutsu</option>
                                            <option value="Taijutsu">Taijutsu</option>
                                            <option value="Fūinjutsu">Fūinjutsu</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label for="ramaSec2" class="col-2 col-form-label text-md-left">Tercera Rama:</label>
                                    <div class="col-7">
                                        <select id="ramaSec2" class="form-control" name="ramaSec2">
                                            <option value="Ninjutsu General">Ninjutsu General</option>
                                            <option value="Elemento Viento">Elemento Viento</option>
                                            <option value="Elemento Fuego">Elemento Fuego</option>
                                            <option value="Elemento Tierra">Elemento Tierra</option>
                                            <option value="Elemento Rayo">Elemento Rayo</option>
                                            <option value="Elemento Agua">Elemento Agua</option>
                                            <option value="Bukijutsu">Bukijutsu</option>
                                            <option value="Genjutsu">Genjutsu</option>
                                            <option value="Taijutsu">Taijutsu</option>
                                            <option value="Fūinjutsu">Fūinjutsu</option>
                                        </select>
                                    </div>
                                </div>
                          </div>
                          <div class="tab-pane fade" id="atributos" role="tabpanel" aria-labelledby="atributos-tab">
                            <h3>Atributos</h3><br>
                            <h5>Puntos Faltantes: <span id="puntos"></span></h5>
                            <hr></hr>
                                <div class="form-group row">
                                    <label for="atrFuerza" class="col-3 col-form-label text-md-left">Fuerza:</label>
                                    <div class="col-3">
                                        <input type="number" class="form-control" name="atrFuerza" id="atrFuerza" size="10" value="1" required="required" onblur="checkAtributos(this); calcEstadisticas(false);" />
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label for="artAg" class="col-3 col-form-label text-md-left">Agilidad:</label>
                                    <div class="col-3">
                                        <input type="number" class="form-control" name="artAg" id="artAg" size="10" value="1" required="required" onblur="checkAtributos(this); calcEstadisticas(false); " />
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label for="atrVit" class="col-3 col-form-label text-md-left">Vitalidad:</label>
                                    <div class="col-3">
                                        <input type="number" class="form-control" name="atrVit" id="atrVit" size="10" value="1" required="required" onblur="checkAtributos(this); calcEstadisticas(false); " />
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label for="atrCon" class="col-3 col-form-label text-md-left">Concentraci&oacute;n:</label>
                                    <div class="col-3">
                                        <input type="number" class="form-control" name="atrCon" id="atrCon" size="10" value="1" required="required" onblur="checkAtributos(this); calcEstadisticas(false); " />
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label for="atrCCK" class="col-3 col-form-label text-md-left">Control del chakra:</label>
                                    <div class="col-3">
                                        <input type="number" class="form-control" name="atrCCK" id="atrCCK" size="10" value="1" required="required" onblur="checkAtributos(this); calcEstadisticas(false); " />
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label for="atrVol" class="col-3 col-form-label text-md-left">Voluntad:</label>
                                    <div class="col-3">
                                        <input type="number" class="form-control" name="atrVol" id="atrVol" size="10" value="1" required="required" onblur="checkAtributos(this); calcEstadisticas(false); " />
                                    </div>
                                </div>
                                <h3>Estadísticas</h3><br>
                                    <div class="form-group row">
                                    <label for="vida" class="col-2 col-form-label text-md-left">Puntos de vida:</label>
                                    <div class="col-4">
                                        <input type="number" class="form-control" name="vida" id="vida" size="10" disabled="disabled" />
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label for="chakra" class="col-2 col-form-label text-md-left">Puntos de chakra:</label>
                                    <div class="col-4">
                                        <input type="number" class="form-control" name="chakra" id="chakra" size="10" disabled="disabled" />
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label for="stamina" class="col-2 col-form-label text-md-left">Puntos de stamina:</label>
                                    <div class="col-4">
                                        <input type="number" class="form-control" name="stamina" id="stamina" size="10" disabled="disabled" />
                                    </div>
                                  </div>
                          </div>
                          <div class="tab-pane fade" id="atributos" role="tabpanel" aria-labelledby="atributos-tab">4</div>

                        </div>
                    </div>
                    <div class="card-footer text-center">
                       <div class="form-group row mb-0">
                            <div class="col-4 offset-md-3">
                                <input type="submit" class="btn btn-primary" value="Crear Ficha">
                                </input>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<script type="text/javascript">
function checkText(elem, num) {
    if (elem.value.length < num) {
        alert('Este campo debe tener más de ' + num + ' caracteres.');
        return false;
    }
    return true;
}

function calcEstadisticas(){
    var fue = document.getElementById('atrFuerza').value;
    var vit = document.getElementById('atrVit').value;
    var con = document.getElementById('atrCon').value;
    var cck = document.getElementById('atrCCK').value;
    var agi = document.getElementById('artAg').value;
    var vol = document.getElementById('atrVol').value;
    var pv = document.getElementById('vida');
    var pc = document.getElementById('chakra');
    var sta = document.getElementById('stamina');
    var puntos = document.getElementById('puntos');

    var usados = parseInt(fue) + parseInt(vit) + parseInt(agi) + parseInt(con) + parseInt(cck) + parseInt(vol);

    puntos.innerHTML = 50 - usados;

    pv.value = parseInt(fue) + parseInt(agi) + parseInt(vit);
    pc.value = parseInt(cck) + parseInt(con) + parseInt(vol);
    sta.value = parseInt(fue) + parseInt(agi) + parseInt(vit) + parseInt(vol);
}

function calcStats(finalCheck) {
    var fue = document.getElementById('atrFuerza').value;
    var vit = document.getElementById('atrVit').value;
    var con = document.getElementById('atrCon').value;
    var cck = document.getElementById('atrCCK').value;
    var agi = document.getElementById('artAg').value;
    var vol = document.getElementById('atrVol').value;
    var pv = document.getElementById('vida');
    var pc = document.getElementById('chakra');
    var sta = document.getElementById('stamina');
    var puntos = document.getElementById('puntos');
    var success = true;

    if (finalCheck == true) {
    usados = parseInt(fue) + parseInt(vit) + parseInt(agi) + parseInt(con) + parseInt(cck) + parseInt(vol);
    if (usados > 50) {
        alert('¡No puedes repartir más de 50 puntos!');
        success = false;
    } else {
        pv.value = parseInt(fue) + parseInt(agi) + parseInt(vit);
        pc.value = parseInt(cck) + parseInt(con) + parseInt(vol);
        sta.value = parseInt(fue) + parseInt(agi) + parseInt(vit) + parseInt(vol);
    }

    puntos.innerHTML = 50 - usados;
    
    if (usados < 50 && finalCheck) {
        alert('Aún te faltan puntos de atributo por repartir');
        success = false;
    }

    return success;
    }
}

function checkRamas(){
    var rama2 = document.getElementById('ramaSec1').value;
    var rama3 = document.getElementById('ramaSec2').value;
    var success = true;
    if (rama2 == rama3) 
    { 
        alert("Las ramas secundarias no pueden ser iguales");
        success = false;
    }

    return success;
}

function checkAtributos(atr) {
  var fue = document.getElementById('atrFuerza').value;
  var vit = document.getElementById('atrVit').value;
  var con = document.getElementById('atrCon').value;
  var cck = document.getElementById('atrCCK').value;
  var agi = document.getElementById('artAg').value;
  var vol = document.getElementById('atrVol').value;

  var points = [fue, vit, con, cck, agi, vol];

  points.sort(function(a, b){return a-b});

  var attr_min = 10;
  var dif = points[5] - points[0];

  if (dif > 10) {
    alert('La puntuación maxima no debe superar al atributo menor en mas de 10 puntos.');
    attr_min = parseInt(points[0]) + 10;
    atr.value = attr_min;
    return false;
  }

    if (parseInt(atr.value) < 1) {
        alert('La puntuación mínima en atributos es 1.');
        return false;
    }
    return true;
}

function checkFicha() {
    var nombre = document.getElementById('name');
    var descFis = document.getElementById('descFis');
    var descPsic = document.getElementById('descPsic');
    var fue = document.getElementById('atrFuerza').value;
    var vit = document.getElementById('atrVit').value;
    var con = document.getElementById('atrCon').value;
    var cck = document.getElementById('atrCCK').value;
    var agi = document.getElementById('artAg').value;
    var vol = document.getElementById('atrVol').value;
    var rama2 = document.getElementById('ramaSec1').value;
    var rama3 = document.getElementById('ramaSec2').value;

    return checkAtributos(fue) && checkAtributos(vit) && checkAtributos(con) && checkAtributos(cck) && checkAtributos(agi) && checkAtributos(vol) && calcStats(true) && checkText(nombre, 5) && checkText(descFis, 200) && checkText(descPsic, 200) && checkRamas();
}
</script>
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
<!-- INCLUDE overall_footer.html -->